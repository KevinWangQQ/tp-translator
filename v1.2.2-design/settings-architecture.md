# v1.2.2 Settings页面架构设计

## 🏗️ 整体设计思路

### 当前问题分析
- v1.2.1的Settings页面只有2个标签：Common 和 Translation Memories
- 所有设置混在一起，缺乏逻辑分组
- 缺少Prompt自定义和专业词库功能
- 翻译历史记录功能缺失

### 新架构目标
- **3个专门的标签页**，功能清晰分离
- **响应式设计**，适配插件小界面
- **用户友好**，降低配置复杂度
- **可扩展性**，为未来功能预留空间

## 📱 标签页架构设计

### 1. 🌐 语言&模型 (Language & Models)
**原名**: Common → 重构为专门的语言和引擎配置

**核心功能**:
- 默认目标语言设置
- 翻译引擎配置 (OpenAI/Gemini)  
- API密钥管理
- 模型选择和说明

**界面布局**:
```
🌐 语言&模型
┌─────────────────────────────────────┐
│ 📋 默认设置                         │
│ ┌─────────────────────────────────┐ │
│ │ 默认目标语言: [英语 ▼]          │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 🔑 翻译引擎                         │
│ ┌─────────────────────────────────┐ │
│ │ ◉ Google Gemini    [已连接 ✅] │ │
│ │   API Key: [AIza...] [测试连接]  │ │
│ │   模型: [Gemini 1.5 Flash ▼]    │ │
│ │   💡 快速、经济、质量优秀        │ │
│ │                                 │ │
│ │ ○ OpenAI          [未配置 ⚠️]   │ │
│ │   API Key: [sk-...] [测试连接]   │ │
│ │   模型: [GPT-4 ▼]               │ │
│ │   💡 高质量、成本较高            │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 2. 📝 Prompt设置 (Prompt Settings)
**全新功能**，开放Prompt定制能力

**核心功能**:
- 场景描述自定义
- 专业词库管理
- 翻译约束设置

**界面布局**:
```
📝 Prompt设置
┌─────────────────────────────────────┐
│ 📋 场景描述 (可选)                   │
│ ┌─────────────────────────────────┐ │
│ │ 描述当前设计项目的场景，帮助AI    │ │
│ │ 选择更合适的翻译风格              │ │
│ │ ┌─────────────────────────────┐ │ │
│ │ │ 这是一个电商APP的商品页面，   │ │ │
│ │ │ 面向年轻消费者，注重简洁易懂  │ │ │
│ │ │                             │ │ │
│ │ └─────────────────────────────┘ │ │
│ │ 💡 留空将使用默认通用描述        │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 📖 专业词库 (3)                     │
│ ┌─────────────────────────────────┐ │
│ │ 用户体验 → User Experience [×]   │ │
│ │ 人工智能 → AI              [×]   │ │
│ │ 云计算   → Cloud Computing  [×]   │ │
│ │ ┌─────────────────────────────┐ │ │
│ │ │ [+ 添加词条] [导入] [导出]    │ │ │
│ │ └─────────────────────────────┘ │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 3. 📚 翻译历史 (Translation History)
**全新功能**，替代原有的Translation Memories

**核心功能**:
- 历史翻译记录列表
- 搜索和过滤功能
- 记录管理和导出

**界面布局**:
```
📚 翻译历史
┌─────────────────────────────────────┐
│ 🔍 [搜索历史记录...] [清空全部]      │
│                                     │
│ 📅 2025-09-05 14:32                 │
│ ┌─────────────────────────────────┐ │
│ │ 登录按钮 → Login Button          │ │
│ │ 引擎: Gemini 1.5 Flash    [复用] │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 📅 2025-09-05 14:28                 │
│ ┌─────────────────────────────────┐ │
│ │ 用户设置 → User Settings         │ │
│ │ 引擎: GPT-4              [复用] │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ... 显示更多历史记录 ...              │
└─────────────────────────────────────┘
```

## 🎨 视觉设计考虑

### 小界面适配策略
1. **垂直布局**：充分利用高度，减少横向空间占用
2. **折叠展开**：非关键信息可折叠，保持界面整洁
3. **图标语义**：使用直观图标辅助文字，节省空间
4. **渐进式信息**：重要信息优先展示，细节按需展开

### 专业词库界面挑战解决
**问题**：多条目在小界面中的展示

**解决方案**：
- **条目卡片化**：每个词条一个简洁卡片
- **限制初始显示**：最多显示3条，更多折叠
- **快速操作**：编辑/删除按钮紧凑排列
- **批量管理**：提供导入/导出功能

### 响应式布局
```css
/* 标签页适配 */
.settings-tabs {
  display: flex;
  flex-shrink: 0;
}

.settings-tab {
  flex: 1;
  min-width: 0; /* 防止文字溢出 */
  text-overflow: ellipsis;
}

/* 内容区域滚动 */
.settings-body {
  flex: 1;
  overflow-y: auto;
  min-height: 0;
}

/* 词库条目样式 */
.glossary-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border: 1px solid #e5e7eb;
  border-radius: 6px;
  margin-bottom: 8px;
  font-size: 13px;
}
```

## 🔧 技术实现要点

### 1. 状态管理扩展
```javascript
// 扩展appState结构
let appState = {
  // 现有字段保持不变
  engines: { ... },
  settings: {
    defaultTargetLang: 'en', // 新增：默认目标语言
    designContext: '',       // 新增：场景描述
    glossary: [],           // 新增：专业词库
  },
  translationHistory: [],   // 新增：翻译历史
  // ...
}
```

### 2. Prompt系统重构
```javascript
// Prompt模板系统
class PromptBuilder {
  constructor() {
    this.basePrompt = "你是一个专业的UI/UX翻译专家..."; // 核心不变
  }
  
  buildPrompt(designContext, glossary) {
    let prompt = this.basePrompt;
    
    // 注入场景描述
    if (designContext) {
      prompt += `\\n\\n设计场景：${designContext}`;
    }
    
    // 注入专业词库
    if (glossary && glossary.length > 0) {
      prompt += `\\n\\n专业词库：\\n${this.formatGlossary(glossary)}`;
    }
    
    return prompt;
  }
  
  formatGlossary(glossary) {
    return glossary.map(item => 
      `- ${item.source} → ${item.target}`
    ).join('\\n');
  }
}
```

### 3. 数据持久化
```javascript
// 数据存储结构
const storageSchema = {
  engines: { /* 现有引擎配置 */ },
  settings: {
    defaultTargetLang: 'en',
    designContext: '',
    glossary: [
      { id: 1, source: '用户体验', target: 'User Experience', createdAt: '2025-09-05' }
    ]
  },
  translationHistory: [
    { id: 1, originalText: '登录', translatedText: 'Login', engine: 'gemini-1.5-flash', timestamp: '2025-09-05T14:32:00Z' }
  ]
}
```

## 🚀 实施计划

### 阶段1: UI重构 (优先级: 高)
- [ ] 重新设计3个标签页的HTML结构
- [ ] 更新CSS样式，确保小界面适配
- [ ] 实现标签页切换逻辑

### 阶段2: 语言&模型页面 (优先级: 高)
- [ ] 添加默认目标语言设置
- [ ] 优化引擎配置界面
- [ ] 添加模型性能说明

### 阶段3: Prompt设置页面 (优先级: 高)
- [ ] 实现场景描述文本区域
- [ ] 设计并实现专业词库管理界面
- [ ] 集成Prompt构建逻辑

### 阶段4: 翻译历史页面 (优先级: 中)
- [ ] 实现历史记录列表显示
- [ ] 添加搜索和过滤功能
- [ ] 实现记录管理功能

### 阶段5: 集成测试 (优先级: 高)
- [ ] 端到端功能测试
- [ ] 小界面适配测试
- [ ] 性能优化

## ⚠️ 风险与注意事项

1. **翻译质量保障**
   - 确保Prompt变更不影响翻译效果
   - 对用户输入进行格式验证
   - 提供默认值防止配置错误

2. **界面适配风险**
   - 在不同屏幕尺寸下测试
   - 确保滚动和交互正常
   - 避免内容溢出或重叠

3. **数据迁移**
   - 保持与v1.2.1的配置兼容
   - 提供设置迁移逻辑
   - 处理数据结构变更

4. **性能考虑**
   - 词库条目过多时的渲染性能
   - 历史记录大量数据的处理
   - 避免频繁的DOM操作

---

*设计文档 v1.0 - 2025年9月5日*